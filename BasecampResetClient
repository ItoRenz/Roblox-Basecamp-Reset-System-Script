-- ===== CLIENT SCRIPT (StarterGui > LocalScript) =====
-- Letakkan script ini sebagai LocalScript di StarterGui

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- Detect mobile or PC
local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

-- ===== CREATE OR GET REMOTE EVENT =====
local resetEvent = ReplicatedStorage:FindFirstChild("ResetCheckpointEvent")
if not resetEvent then
    resetEvent = Instance.new("RemoteEvent")
    resetEvent.Name = "ResetCheckpointEvent"
    resetEvent.Parent = ReplicatedStorage
end

-- ===== BASECAMP RESET FUNCTION (Client-side) =====
local function resetToBasecamp()
    local character = player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then
        warn("⚠️ Character tidak ditemukan atau HumanoidRootPart hilang")
        return
    end
    
    -- PANGGIL SERVER UNTUK RESET CHECKPOINT
    resetEvent:FireServer("ResetCheckpoint")
    
    -- Cari basecamp (kompatibel dengan berbagai nama)
    local basecamp = workspace:FindFirstChild("Basecamp") 
        or workspace:FindFirstChild("SpawnLocation") 
        or workspace:FindFirstChild("Base")
        or workspace:FindFirstChild("Spawn")
    
    if basecamp then
        local spawnPart = basecamp
        if not basecamp:IsA("BasePart") then
            spawnPart = basecamp:FindFirstChildWhichIsA("BasePart", true)
        end
        
        if spawnPart and spawnPart:IsA("BasePart") then
            local spawnPos = spawnPart.Position + Vector3.new(0, 3, 0)
            character:MoveTo(spawnPos)
            print("✓ Reset ke basecamp berhasil!")
        else
            character:MoveTo(basecamp:GetPivot().Position + Vector3.new(0, 3, 0))
            print("✓ Reset ke basecamp berhasil (pivot)!")
        end
    else
        character:MoveTo(Vector3.new(0, 50, 0))
        warn("⚠️ Basecamp tidak ditemukan, spawn di default location")
    end
    
    -- Reset velocity dan rotation
    local hrp = character.HumanoidRootPart
    if hrp then
        hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
        hrp.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
        hrp.CFrame = CFrame.new(hrp.Position) * CFrame.Angles(0, hrp.CFrame:ToEulerAnglesYXZ(), 0)
    end
    
    -- Heal character
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid.Health = humanoid.MaxHealth
        print("✓ Health restored")
    end
end

-- ===== CREATE GUI =====
local playerGui = player:WaitForChild("PlayerGui")
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BasecampResetGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Main Button
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ResetButton"
toggleButton.Size = UDim2.new(0, isMobile and 32 or 36, 0, isMobile and 32 or 36)
toggleButton.Position = isMobile and UDim2.new(1, -42, 0, -2) or UDim2.new(1, -42, 0, -2)
toggleButton.BackgroundColor3 = Color3.fromRGB(255, 107, 107)
toggleButton.BackgroundTransparency = 0
toggleButton.BorderSizePixel = 0
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 28
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Text = "⌂"
toggleButton.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = toggleButton

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(255, 200, 200)
stroke.Thickness = 2
stroke.Parent = toggleButton

-- Label di bawah button
local labelText = Instance.new("TextLabel")
labelText.Name = "ResetLabel"
labelText.Size = UDim2.new(0, 50, 0, 15)
labelText.Position = isMobile and UDim2.new(1, -50, 0, 28) or UDim2.new(1, -48, 0, 35)
labelText.BackgroundTransparency = 1
labelText.TextColor3 = Color3.fromRGB(255, 107, 107)
labelText.TextSize = 11
labelText.Font = Enum.Font.GothamBold
labelText.Text = "RESET"
labelText.Parent = screenGui

-- Tooltip saat hover
local tooltip = Instance.new("TextLabel")
tooltip.Name = "ResetTooltip"
tooltip.Size = UDim2.new(0, 160, 0, 55)
tooltip.Position = UDim2.new(1, -170, 0, -5)
tooltip.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
tooltip.BackgroundTransparency = 0.1
tooltip.TextColor3 = Color3.fromRGB(255, 255, 255)
tooltip.TextSize = 11
tooltip.Font = Enum.Font.Gotham
tooltip.Text = "Click to Reset\n• Back to Basecamp\n• Reset Checkpoint"
tooltip.TextWrapped = true
tooltip.Visible = false
tooltip.Parent = screenGui

local tooltipCorner = Instance.new("UICorner")
tooltipCorner.CornerRadius = UDim.new(0, 8)
tooltipCorner.Parent = tooltip

local tooltipStroke = Instance.new("UIStroke")
tooltipStroke.Color = Color3.fromRGB(255, 107, 107)
tooltipStroke.Thickness = 1.5
tooltipStroke.Parent = tooltip

-- Hover effect untuk show tooltip
toggleButton.MouseEnter:Connect(function()
    local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    TweenService:Create(toggleButton, tweenInfo, {BackgroundColor3 = Color3.fromRGB(255, 85, 85)}):Play()
    TweenService:Create(stroke, tweenInfo, {Color = Color3.fromRGB(255, 150, 150)}):Play()
    TweenService:Create(labelText, tweenInfo, {TextColor3 = Color3.fromRGB(255, 200, 200)}):Play()
end)

toggleButton.MouseLeave:Connect(function()
    local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    TweenService:Create(toggleButton, tweenInfo, {BackgroundColor3 = Color3.fromRGB(255, 107, 107)}):Play()
    TweenService:Create(stroke, tweenInfo, {Color = Color3.fromRGB(255, 200, 200)}):Play()
    TweenService:Create(labelText, tweenInfo, {TextColor3 = Color3.fromRGB(255, 107, 107)}):Play()
end)

-- Click animation dengan pulse effect
toggleButton.MouseButton1Click:Connect(function()
    local pulseDown = TweenService:Create(
        toggleButton,
        TweenInfo.new(0.08, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
        {Size = UDim2.new(0, isMobile and 29 or 32, 0, isMobile and 29 or 32), Position = UDim2.new(1, -40, 0, -1)}
    )
    pulseDown:Play()
    
    resetToBasecamp()
    
    pulseDown.Completed:Connect(function()
        TweenService:Create(
            toggleButton,
            TweenInfo.new(0.12, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, isMobile and 32 or 36, 0, isMobile and 32 or 36), Position = UDim2.new(1, -42, 0, -2)}
        ):Play()
    end)
    
    TweenService:Create(stroke, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), 
        {Color = Color3.fromRGB(255, 255, 255), Thickness = 3}):Play()
    
    wait(0.15)
    TweenService:Create(stroke, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), 
        {Color = Color3.fromRGB(255, 200, 200), Thickness = 2}):Play()
end)

toggleButton.TouchTap:Connect(function()
    resetToBasecamp()
end)

print("✓ Basecamp Reset Script Loaded (CLIENT)!")
print("✓ Compatible with StatsCore Sequential CP System")
print("✓ Checkpoint akan di-reset via SERVER")
