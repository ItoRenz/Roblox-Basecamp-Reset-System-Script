-- Script ini harus diletakkan di StarterGui (LocalScript)
-- Kompatibel dengan StatsCore.server.lua (Sequential CP + Summit System)

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- Detect apakah player menggunakan mobile atau PC
local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

-- ===== CHECKPOINT RESET FUNCTION =====
local function resetCheckpoint()
    local character = player.Character
    if not character then return end
    
    -- Reset leaderstats checkpoint ke 0
    local leaderstats = player:FindFirstChild("leaderstats")
    if leaderstats then
        -- Reset Checkpoint value (sesuai StatsCore system)
        local checkpoint = leaderstats:FindFirstChild("Checkpoint") 
            or leaderstats:FindFirstChild("CheckPoint")
            or leaderstats:FindFirstChild("checkpoint")
            or leaderstats:FindFirstChild("CHECKPOINT")
        
        if checkpoint and checkpoint:IsA("IntValue") then
            checkpoint.Value = 0
            print("✓ Checkpoint direset ke 0 (Sequential CP System)")
        end
        
        -- TIDAK reset Summit value - hanya reset progress CP
        -- Summit tetap tersimpan sebagai pencapaian permanen
        local summit = leaderstats:FindFirstChild("Summit")
            or leaderstats:FindFirstChild("summit") 
            or leaderstats:FindFirstChild("SUMMIT")
        
        if summit and summit:IsA("IntValue") then
            print(("ℹ️ Summit tetap: %d (tidak direset)"):format(summit.Value))
        end
    end
    
    -- Reset RespawnLocation ke nil (force spawn di default)
    player.RespawnLocation = nil
    print("✓ RespawnLocation direset")
end

-- ===== BASECAMP RESET FUNCTION =====
local function resetToBasecamp()
    local character = player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then
        warn("⚠️ Character tidak ditemukan atau HumanoidRootPart hilang")
        return
    end
    
    -- Reset checkpoint terlebih dahulu
    resetCheckpoint()
    
    -- Cari basecamp (kompatibel dengan berbagai nama)
    local basecamp = workspace:FindFirstChild("Basecamp") 
        or workspace:FindFirstChild("SpawnLocation") 
        or workspace:FindFirstChild("Base")
        or workspace:FindFirstChild("Spawn")
    
    if basecamp then
        -- Jika basecamp adalah folder/model, cari part di dalamnya
        local spawnPart = basecamp
        if not basecamp:IsA("BasePart") then
            spawnPart = basecamp:FindFirstChildWhichIsA("BasePart", true)
        end
        
        if spawnPart and spawnPart:IsA("BasePart") then
            local spawnPos = spawnPart.Position + Vector3.new(0, 3, 0)
            character:MoveTo(spawnPos)
            print("✓ Reset ke basecamp berhasil!")
        else
            -- Fallback: gunakan position folder/model
            character:MoveTo(basecamp:GetPivot().Position + Vector3.new(0, 3, 0))
            print("✓ Reset ke basecamp berhasil (pivot)!")
        end
    else
        -- Jika tidak ada basecamp, teleport ke 0,50,0
        character:MoveTo(Vector3.new(0, 50, 0))
        warn("⚠️ Basecamp tidak ditemukan, spawn di default location")
    end
    
    -- Reset velocity dan rotation
    local hrp = character.HumanoidRootPart
    if hrp then
        hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
        hrp.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
        -- Reset orientasi agar tidak terbalik
        hrp.CFrame = CFrame.new(hrp.Position) * CFrame.Angles(0, hrp.CFrame:ToEulerAnglesYXZ(), 0)
    end
    
    -- Heal character
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid.Health = humanoid.MaxHealth
        print("✓ Health restored")
    end
end

-- ===== CREATE GUI =====
local playerGui = player:WaitForChild("PlayerGui")
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BasecampResetGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Tentukan ukuran button yang lebih kecil - Mobile: 32x32, PC: 36x36
local buttonSizeX = isMobile and 32 or 36
local buttonSizeY = isMobile and 32 or 36
local buttonSize = UDim2.new(0, buttonSizeX, 0, buttonSizeY)
-- Posisi di pojok kanan atas mepet layar (mentok atas)
local buttonPosition = UDim2.new(1, -42, 0, -2)

-- Main Button (Toggle Style)
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ResetButton"
toggleButton.Size = buttonSize
toggleButton.Position = buttonPosition
toggleButton.BackgroundColor3 = Color3.fromRGB(59, 89, 152) -- Biru elegan
toggleButton.BackgroundTransparency = 0.1
toggleButton.BorderSizePixel = 0
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = isMobile and 18 or 20
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Text = "⌂"  -- Home icon
toggleButton.Parent = screenGui

-- Corner radius (modern look)
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = toggleButton

-- Stroke untuk border yang lebih menarik
local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(100, 150, 220)
stroke.Thickness = 1.5
stroke.Parent = toggleButton

-- Hover effect dengan animasi ringan
toggleButton.MouseEnter:Connect(function()
    -- Change color smooth
    local tweenInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    TweenService:Create(
        toggleButton,
        tweenInfo,
        {BackgroundColor3 = Color3.fromRGB(79, 109, 172)}
    ):Play()
    
    -- Change stroke color
    TweenService:Create(
        stroke,
        tweenInfo,
        {Color = Color3.fromRGB(150, 200, 255)}
    ):Play()
end)

toggleButton.MouseLeave:Connect(function()
    -- Reset color smooth
    local tweenInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    TweenService:Create(
        toggleButton,
        tweenInfo,
        {BackgroundColor3 = Color3.fromRGB(59, 89, 152)}
    ):Play()
    
    -- Reset stroke color
    TweenService:Create(
        stroke,
        tweenInfo,
        {Color = Color3.fromRGB(100, 150, 220)}
    ):Play()
end)

-- Click animation dengan pulse effect (ringan dan smooth)
toggleButton.MouseButton1Click:Connect(function()
    -- Pulse effect 1 - Scale down sedikit
    local pulseDown = TweenService:Create(
        toggleButton,
        TweenInfo.new(0.05, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
        {Size = UDim2.new(0, buttonSizeX * 0.9, 0, buttonSizeY * 0.9)}
    )
    pulseDown:Play()
    
    -- Reset to basecamp
    resetToBasecamp()
    
    -- Pulse effect 2 - Scale kembali normal
    pulseDown.Completed:Connect(function()
        TweenService:Create(
            toggleButton,
            TweenInfo.new(0.08, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out),
            {Size = buttonSize}
        ):Play()
    end)
    
    -- Flash effect pada stroke
    TweenService:Create(
        stroke,
        TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {Color = Color3.fromRGB(255, 255, 255)}
    ):Play()
    
    wait(0.1)
    
    -- Stroke kembali normal
    TweenService:Create(
        stroke,
        TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {Color = Color3.fromRGB(100, 150, 220)}
    ):Play()
end)

-- Touch support untuk mobile
toggleButton.TouchTap:Connect(function()
    resetToBasecamp()
end)

-- ===== NOTIFICATION FUNCTION =====
local function showNotification(text, duration)
    local label = Instance.new("TextLabel")
    label.Name = "ResetNotification"
    label.Size = UDim2.new(0, 220, 0, 45)
    label.Position = UDim2.new(1, -240, 0, 55)
    label.BackgroundColor3 = Color3.fromRGB(59, 89, 152)
    label.BackgroundTransparency = 0.15
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 12
    label.Font = Enum.Font.Gotham
    label.Text = text
    label.TextWrapped = true
    label.Parent = screenGui
    
    local labelCorner = Instance.new("UICorner")
    labelCorner.CornerRadius = UDim.new(0, 8)
    labelCorner.Parent = label
    
    local labelStroke = Instance.new("UIStroke")
    labelStroke.Color = Color3.fromRGB(100, 150, 220)
    labelStroke.Thickness = 1
    labelStroke.Parent = label
    
    wait(duration or 3)
    label:Destroy()
end

-- Tampilkan notif saat spawn
showNotification("⌂ Basecamp Reset Ready\n• Reset Checkpoint ke 0\n• Summit tetap tersimpan", 5)

print("✓ Basecamp Reset Script Loaded!")
print("✓ Compatible with StatsCore Sequential CP System")
print("✓ Checkpoint reset to 0, Summit preserved")
print("✓ Toggle Button Size - Mobile: 32x32, PC: 36x36")
print("✓ Button Position - Pojok Kanan Atas Mentok")
print("✓ Animasi: Pulse + Flash Effect (Ringan & Smooth)")
